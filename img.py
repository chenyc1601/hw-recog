# -*- coding: utf-8 -*-

import PIL.Image as pImage
import numpy as np
import base64
import matplotlib.pyplot as plt
from io import BytesIO
import re

class Image :
    """将base64 jpeg url处理为用于识别的数据
    """
    def __init__(self, url) :
        base64Data = re.sub('^data:image/.+;base64,', '', url)  # 去掉URL头部
        byteData = base64.b64decode(base64Data)  # decode
        imgData = BytesIO(byteData)  # 转成图片Byte
        img = pImage.open(imgData)  # 读图片
        imgGray = img.convert('L')  # 读灰度图
        img28 = imgGray.resize((28, 28))  # 转28*28
        array = np.array(img28)  # 转矩阵
        array1_784 = array.reshape((1, 784))  # 转为1*784
        arrayInvert = 255.0 - array1_784  # 白底转黑底
        self.imgData = np.asfarray(arrayInvert) / 255.0 * 0.99 + 0.01
    
if __name__ == "__main__" :
    testURL = "data:image/jpeg;base64,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"
    testImage = Image(testURL)
    print(testImage.imgData)
    imageArray = testImage.imgData.reshape((28, 28))
    plt.imshow(imageArray, cmap='Greys', interpolation='None')
    plt.draw()
    plt.pause(5)
    